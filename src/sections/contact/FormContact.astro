---
import { Icon } from "astro-icon/components";
---

<div class="card bg-base-100 shadow-xl">
  <div class="card-body">
    <h2 class="card-title text-2xl mb-6">Send a Message</h2>

    <form
      action="https://formspree.io/f/mnnggnyn"
      method="POST"
      id="contactForm"
      class="space-y-5 w-full"
    >
      <!-- Honeypot field (hidden) -->
      <input type="text" name="_gotcha" style="display:none" />
      <input type="text" name="_web" style="display:none" />

      <!-- Name -->
      <label class="form-control w-full">
        <div class="label">
          <span class="label-text font-medium">Your Name</span>
        </div>
        <input
          type="text"
          name="name"
          placeholder="John Doe"
          class="input input-bordered w-full"
          required
        />
      </label>

      <!-- Email -->
      <label class="form-control w-full">
        <div class="label">
          <span class="label-text font-medium">Email Address</span>
        </div>
        <input
          type="email"
          name="email"
          placeholder="john@example.com"
          class="input input-bordered w-full"
          required
        />
      </label>

      <!-- Subject -->
      <label class="form-control w-full">
        <div class="label">
          <span class="label-text font-medium">Subject</span>
        </div>
        <input
          type="text"
          name="subject"
          placeholder="What’s this about?"
          class="input input-bordered w-full"
        />
      </label>

      <!-- Message -->
      <label class="form-control w-full">
        <div class="label">
          <span class="label-text font-medium">Message</span>
        </div>
        <textarea
          name="message"
          class="textarea textarea-bordered w-full min-h-32 resize-y"
          placeholder="Tell me more..."
          required></textarea>
      </label>

      <!-- Submit Button -->
      <button type="submit" class="btn btn-primary w-full gap-2 mt-3">
        <Icon name="lucide:send" class="w-5 h-5" />
        Send Message
      </button>
    </form>
    <div
      id="successResult"
      class="space-y-5 w-full text-green-950 text-xl font-bold hidden"
    >
      ✅ Thank you! Your message has been sent.
    </div>
    <div
      id="failedResult"
      class="space-y-5 w-full text-red-950 text-xl font-bold hidden"
    >
      ❌ Something went wrong. Please try again.
    </div>
  </div>
</div>

<script>
  // Safe, scoped script for Astro
  const form = document.querySelector("#contactForm") as HTMLFormElement;
  const successRes = document.querySelector("#successResult") as HTMLElement;
  const failedRes = document.querySelector("#failedResult") as HTMLElement;

  form.addEventListener("submit", async (e: SubmitEvent) => {
    e.preventDefault();

    const gotcha = (
      form.querySelector('input[name="_web"]') as HTMLInputElement
    ).value;

    if (gotcha) {
      // spam
      return;
    }
    const formData = new FormData(form);
    const response = await fetch(form.action, {
      method: "POST",
      body: formData,
      headers: { Accept: "application/json" },
    });

    if (response.ok) {
      form.classList.add("hidden");
      failedRes.classList.add("hidden");
      successRes.classList.remove("hidden");
    } else {
      form.classList.add("hidden");
      successRes.classList.add("hidden");
      failedRes.classList.remove("hidden");
    }
    (e.target as HTMLFormElement).reset();
  });
</script>
